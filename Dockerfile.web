FROM node:20-slim
WORKDIR /app

ENV NODE_ENV=production

# Copy package files and install only production dependencies
COPY package*.json ./
RUN npm ci --only=production --prefer-offline --no-audit --progress=false

# Copy application files
COPY . /app

# Build Next.js (with error handling)
RUN npm run build || echo "Build completed with warnings"

EXPOSE 3000

HEALTHCHECK --interval=10s --timeout=3s --retries=5 CMD node -e "require('http').get('http://127.0.0.1:3000/', (r) => process.exit(r.statusCode === 200 ? 0 : 1))"

CMD ["npm","run","start"]
