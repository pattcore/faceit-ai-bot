# Инструкция по сборке и деплою Faceit AI Bot ## Содержание - [Требования](#требования) - [Быстрый старт](#быстрый-старт) - [Режим разработки](#режим-разработки) - [Продакшн деплой](#продакшн-деплой) - [Полезные команды](#полезные-команды) - [Структура проекта](#структура-проекта) - [Troubleshooting](#troubleshooting) ## Требования Перед началом работы убедитесь, что у вас установлено: - **Node.js** >= 18.x - **npm** >= 9.x - **Docker** >= 20.x - **Docker Compose** >= 2.x - **Python** >= 3.9 (для backend API) ## Быстрый старт ### 1. Клонирование и настройка ```bash # Клонируйте репозиторий (если еще не сделали) git clone <your-repo-url> cd faceit-ai-bot # Создайте .env файл из примера cp .env.example .env # Отредактируйте .env файл (установите секретные ключи) nano .env # или используйте ваш любимый редактор ``` ### 2. Установка зависимостей ```bash # Используя Makefile make install # Или напрямую npm install ``` ### 3. Полная сборка проекта ```bash # Используя Makefile make build # Или используя скрипт chmod +x build-all.sh ./build-all.sh # Или вручную npm run build # Next.js npm run webpack:build # Browser extension docker-compose build # Docker images ``` ### 4. Запуск всех сервисов ```bash # Используя Makefile make deploy # Или используя скрипт chmod +x deploy.sh ./deploy.sh # Или вручную docker-compose up -d ``` После запуска сервисы будут доступны по адресам: - Frontend**: http://localhost:3000 - **Backend API**: http://localhost:8000 - API Docs**: http://localhost:8000/docs - PostgreSQL**: localhost:5432 ## Режим разработки Для локальной разработки без Docker: ```bash # Запустить только базу данных в Docker make dev # Или chmod +x dev.sh ./dev.sh ``` Затем в отдельных терминалах: ```bash # Терминал 1: Frontend npm run dev # Терминал 2: Backend python main.py ``` ## Продакшн деплой ### Вариант 1: Docker Compose (рекомендуется) ```bash # Полный деплой make deploy # Или ./deploy.sh ``` ### Вариант 2: Отдельные Docker контейнеры ```bash # Backend API docker build -f Dockerfile.api -t faceit-api . docker run -d -p 8000:8000 --env-file .env faceit-api # Frontend docker build -f Dockerfile.web -t faceit-web . docker run -d -p 3000:3000 --env-file .env faceit-web # Database docker run -d -p 5432:5432 \ -e POSTGRES_USER=faceit \ -e POSTGRES_PASSWORD=faceit \ -e POSTGRES_DB=faceit \ postgres:16 ``` ### Вариант 3: Традиционный деплой ```bash # Backend cd src/server pip install -r ../../requirements.txt uvicorn main:app --host 0.0.0.0 --port 8000 # Frontend npm run build npm start ``` ## Полезные команды ### Makefile команды ```bash make help # Показать все доступные команды make install # Установить зависимости make build # Собрать проект make dev # Режим разработки make deploy # Деплой make test # Запустить тесты make logs # Показать логи всех сервисов make logs-web # Логи frontend make logs-api # Логи backend make stop # Остановить сервисы make restart # Перезапустить сервисы make status # Статус сервисов make clean # Очистить временные файлы ``` ### NPM скрипты ```bash npm run dev # Запуск Next.js в dev режиме npm run build # Сборка Next.js npm run start # Запуск Next.js production npm run webpack:build # Сборка browser extension npm run test # Запуск тестов npm run lint # Проверка кода npm run type-check # Проверка TypeScript npm run build:all # Сборка всего (Next.js + extension) npm run docker:build # Сборка Docker образов npm run docker:up # Запуск Docker контейнеров npm run docker:down # Остановка Docker контейнеров npm run docker:logs # Логи Docker контейнеров ``` ### Docker Compose команды ```bash docker-compose up -d # Запуск в фоне docker-compose down # Остановка docker-compose logs -f # Логи всех сервисов docker-compose logs -f web # Логи frontend docker-compose logs -f api # Логи backend docker-compose ps # Статус контейнеров docker-compose restart # Перезапуск docker-compose build --no-cache # Пересборка без кеша ``` ## 📁 Структура проекта ``` faceit-ai-bot/ ├── app/ # Next.js app directory │ ├── globals.css │ ├── layout.tsx │ └── page.tsx ├── src/ # Исходный код │ ├── server/ # Backend API │ │ └── main.py │ ├── background.js # Browser extension background │ └── Popup.jsx # Browser extension popup ├── public/ # Статические файлы ├── .env # Переменные окружения (создать из .env.example) ├── .env.example # Пример переменных окружения ├── docker-compose.yml # Docker Compose конфигурация ├── Dockerfile # Основной Dockerfile ├── Dockerfile.api # Dockerfile для API ├── Dockerfile.web # Dockerfile для frontend ├── next.config.js # Next.js конфигурация ├── webpack.config.js # Webpack конфигурация ├── package.json # Node.js зависимости ├── requirements.txt # Python зависимости ├── build-all.sh # Скрипт полной сборки ├── deploy.sh # Скрипт деплоя ├── dev.sh # Скрипт для разработки ├── Makefile # Make команды └── BUILD_DEPLOY.md # Эта инструкция ``` ## Troubleshooting ### Проблема: Порты уже заняты ```bash # Проверить, что использует порт lsof -i :3000 # Frontend lsof -i :8000 # Backend lsof -i :5432 # PostgreSQL # Остановить процесс kill -9 <PID> # Или изменить порты в docker-compose.yml ``` ### Проблема: Docker образы не собираются ```bash # Очистить Docker кеш docker system prune -a # Пересобрать без кеша docker-compose build --no-cache ``` ### Проблема: База данных не запускается ```bash # Проверить логи docker-compose logs db # Удалить volume и пересоздать docker-compose down -v docker-compose up -d ``` ### Проблема: Next.js не собирается ```bash # Очистить кеш rm -rf .next node_modules/.cache # Переустановить зависимости rm -rf node_modules package-lock.json npm install # Попробовать собрать снова npm run build ``` ### Проблема: Ошибки TypeScript ```bash # Проверить типы npm run type-check # Если нужно игнорировать ошибки при сборке (не рекомендуется) # Измените в next.config.js: # typescript: { ignoreBuildErrors: true } ``` ### Проблема: CORS ошибки Убедитесь, что в `.env` правильно настроены переменные окружения и в `main.py` добавлены нужные origins в CORS middleware. ### Проблема: Расширение для браузера не работает ```bash # Пересобрать расширение npm run webpack:build # Проверить, что файлы созданы в public/ ls -la public/*.js # Загрузить расширение в браузер: # Chrome: chrome://extensions -> Load unpacked -> выбрать папку public/ ``` ## 📞 Поддержка Если у вас возникли проблемы: 1. Проверьте логи: `make logs` или `docker-compose logs -f` 2. Убедитесь, что все зависимости установлены 3. Проверьте, что `.env` файл настроен правильно 4. Создайте issue в репозитории с описанием проблемы ## Готово! Теперь у вас есть полностью настроенная система сборки и деплоя для Faceit AI Bot!
